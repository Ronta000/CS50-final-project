{% extends "layout.html" %}

{% block title %}
    Quiz
{% endblock %}

{% block main %}

  <h1>Quiz Mode</h1>
  <button onclick="startQuiz()">Start Quiz</button>
  <div id="quiz"></div>
  <button id="submitBtn" style="display:none;" onclick="submitQuiz()">Submit Quiz</button>
  <div id="result"></div>

  <script>
    function normalize(str) {
      return str.trim().toLowerCase().replace(/\s+/g, ' ');
  }
    async function startQuiz() {
    let quizDiv = document.getElementById("quiz");
    quizDiv.innerHTML = "<p>Loading your flashcards...</p>";

    let response = await fetch("/get_flashcards");
    let flashcards = await response.json();

    if (!Array.isArray(flashcards) || flashcards.length < 5) {
        alert("You need at least 5 flashcards to start the quiz.");
        return;
    }

    flashcards = flashcards.sort(() => Math.random() - 0.5);

    quizDiv.innerHTML = "";

    flashcards.forEach((q, index) => {
        quizDiv.innerHTML += `
            <div>
                <p>${index + 1}. ${q.question}</p>
                <input type="text" id="answer${index}" placeholder="Your answer">
            </div>
        `;
    });

    window.currentQuiz = flashcards;
    document.getElementById("submitBtn").style.display = "block";
    document.getElementById("result").innerHTML = "";
}

    function submitQuiz() {
      if (!window.currentQuiz) {
        alert("Please start the quiz first!");
        return;
      }

      let score = 0;
      let questions = window.currentQuiz;
      let resultHTML = "<ul>";

      for (let i = 0; i < questions.length; i++) {
      let ans = document.getElementById("answer" + i).value.trim();
      if (ans === "") {

        alert(`Please fill in all answers before submitting! (Question ${i + 1} is empty)`);
          return;
        }
}
     

      questions.forEach((q, index) => {
        let userAnswer = normalize(document.getElementById("answer" + index).value);
        let correctAnswer = normalize(q.answer);

        if (userAnswer === correctAnswer) {
          score++;
          resultHTML += `<li>Question ${index + 1}: Correct! Your answer: "${userAnswer}"</li>`;
        } else {
          resultHTML += `<li>Question ${index + 1}: Wrong. Your answer: "${userAnswer}", Correct: "${correctAnswer}"</li>`;
        }
      });

      resultHTML += `</ul><h2>Total Score: ${score} / ${questions.length}</h2>`;
      document.getElementById("result").innerHTML = resultHTML;
    }
  </script>
  <style>
  body {
    background-color: #f8faff;
    color: #0d1b2a;
  }

  h1 {
    color: #0d6efd;
    font-weight: 600;
    text-align: center;
    margin-bottom: 30px;
  }

  #quiz {
    max-width: 600px;
    margin: auto;
  }

  #quiz div {
    background-color: #ffffff;
    border: 1px solid #cfd8dc;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 15px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }

  input[type="text"] {
    width: 100%;
    padding: 8px 10px;
    border-radius: 6px;
    border: 1px solid #ced4da;
    transition: 0.2s;
  }

  input[type="text"]:focus {
    border-color: #0d6efd;
    outline: none;
    box-shadow: 0 0 4px rgba(13,110,253,0.3);
  }

  button {
    border: none;
    border-radius: 8px;
    padding: 10px 18px;
    cursor: pointer;
    transition: 0.2s;
  }

  button:hover {
    opacity: 0.9;
  }

  .btn-primary {
    background-color: #0d6efd;
    color: #fff;
  }

  .btn-success {
    background-color: #5cc9eb00;
    color: #fff;
  }

  #result {
    margin-top: 25px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  .list-group-item-success {
    background-color: #e7f3ff;
    color: #0d6efd;
    border: 1px solid #bcd0ff;
  }

  .list-group-item-danger {
    background-color: #fff0f0;
    color: #dc3545;
    border: 1px solid #f5c2c7;
  }
</style>

{% endblock %}